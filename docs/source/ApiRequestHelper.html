<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">var Base = require('../../web/RequestProcessor');

<span id='NGNX-web-ApiRequestHelper'>/**
</span> * @class NGNX.web.ApiRequestHelper
 * A request processor that creates several additional attributes on a request object. This is designed for making
 * it easier to write routes.
 * 
 * Provides the following additions to the request scope:
 * 
 * * **form**: An form or pre-parsed JSON body found in a `POST`, `PUT`, or `DELETE` request.
 * * **url**: Query string parameters passed in the URL.
 * * **route**: Any route variables available via route regex.
 * 
 * _Example route.js_
 * 
 * `POST http://localhost/:userid/token?resend=true`
 * 
 * `{&quot;address&quot;:&quot;jdoe@doe.com&quot;}`
 * 
 * 		'/:user': {
 * 			post: function(req,res){
 * 				var usr = getUser(req.route.userid);
 * 				if (usr.email !== req.form.address)
 * 					throw Error();
 * 				else if (req.url.resend !== undefined){
 * 					if (req.url.resend)
 * 						usr.resendEmail();
 * 					}
 * 			}
 * 		}
 * 
 * This should be implemented as a NGN.web.API#requestProcessor.
 * 
 * **Example**
 * 		var web = new NGN.web.API({
 * 			port: 8182,
 * 			requestProcessor: new NGNX.web.ApiRequestHelper()
 * 		});
 * @singleton
 * @extends NGN.web.RequestProcessor
 */

var Class = Base.extend({
	
<span id='NGNX-web-ApiRequestHelper-method-constructor'>	/**
</span>	 * @constructor
	 * Create a new RequestAid middleware method.
	 * @returns {Function}
	 */
	constructor: function(){
		
		Class.super.constructor.call(this,{
			fn: function(req,res,cont){
				
				req.form = 	req.body !== undefined
							? (req.method.trim().toUpperCase() == 'PUT' 
								|| req.method.trim().toUpperCase() == 'POST'
								|| req.method.trim().toUpperCase() == 'DELETE'
								? (typeof req.body === 'string' ? JSON.parse(req.body) : req.body)
								: {})
							: {};
				req.url		= req.query || {};
				req.route	= req.params || {};
				
				for(var el in req.route){
					if (req.form.hasOwnProperty(el))
						delete req.route[el];
					if (req.url.hasOwnProperty(el))
						delete req.route[el];

				}
				
				cont();
			}
		});
		
	}
	
});

module.exports = Class;</pre>
</body>
</html>
