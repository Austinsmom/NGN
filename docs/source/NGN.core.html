<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">var events  = require('events'),
	util	= require('util');
		
<span id='NGN-core'>/**
</span> * @class NGN.core
 * @singleton
 * @private
 * @extends Class
 * This singleton exposes core business objects that node.js can use in an application. All NGN objects 
 * inherit this class. It should never be used directly in application logic, but it should be used to 
 * extend the NGN namespace/API.
 * 
 * The factory provides common functionality that can be used throughout multiple objects in the
 * extended API. It provides business logic that is more specific to NGN than the {@link BaseClass}.
 * 
 * The following example is an extremely abbreviated version of the NGN.app.Person class.
 *     @example
 *     NGN.core = require('../NGN.core');
 * 
 *     var Person = NGN.core.extend({
 *         constructor: function( config ){
 *             Person.super.constructor.call( this, config );
 * 			   this.first = config.first  || 'Unknown';
 *             this.last  = config.last   || 'Unknown';
 *             this.middle= config.middle || null
 *         },
 *         describe: function() {
 *             console.log('This is '+this.first+' '+(this.middle!==null?this.middle:'')+this.last);
 *         },
 *         register: function() {
 * 	           // Register the user or save all attributes to a database.
 *         }
 *     });
 *
 *     // Create a module out of this.
 *     module.exports = Person;
 * 
 * The factory provides a foundation on which the other objects can be built. Using the `Person` in the example above,
 * a developer could create and register a new user with the following approach:
 * 
 *     @example
 *     var Person = new NGN.app.Person({ first:'John', last:'Doe' }); 
 * 
 *     Person.register();
 * 
 * NGN.**user**.Person is a dynamically constructed namespace, created primarily to more easily understand the business
 * logic of the API. {@link NGN} is responsible for constructing this namespace.
 * @requires NGN
 * @aside guide class_system
 */
var Class = require('./BaseClass').extend({
	
<span id='NGN-core-method-constructor'>	/**
</span>	 * @constructor
	 * Create an NGN core class.
	 */
	constructor: 	function( config ) {
		
						config = config || {};
						
						Class.super.constructor.call(this, config);
						
						Object.defineProperties(this,{
							
<span id='NGN-core-property-_emitter'>							/**
</span>							 * @property
							 * An event emitter for the class. Used internally.
							 * @protected
							 */	
							_emitter: {
								value:		new events.EventEmitter(),
								enumerable: false,
								writable:	true
							}
						});

					},
	
<span id='NGN-core-method-emit'>	/**
</span>	 * @method
	 * Emits an event respective of the object context (i.e. not bubbled to a global level event)
     * @param {String} eventName
     * @param {Object} [metadata]
	 */
	emit: 			function( eventName, metadata ) {
						this._emitter.emit(eventName, metadata || null);
					},
	       
<span id='NGN-core-method-fireEvent'>    /**
</span>     * @method
     * Fires the specified event. Unlike #emit, this event is bubbled to the NGN#BUS.
     * @param {String} eventName
     * @param {Object} [metadata]
     */
    fireEvent: 		function( eventName, metadata ) {   	
				        this.emit( eventName, metadata );
				        if (__NGN.app.hasOwnProperty('EventBus')) {
				        	__NGN.app.EventBus.emit(eventName, metadata);
				        }
				    },
    
<span id='NGN-core-method-fireWarning'>    /**
</span>     * @method
     * Fires a warning event.
     */
    fireWarning:	function( warning ) {
    					//TODO: Add to logger
    					console.log('WARNING:'.yellow.underline+' '+warning.toString().yellow);
				    	this.fireEvent('warn',warning);
				    },
    
<span id='NGN-core-method-fireError'>    /**
</span>     * @method
     * Fires the specified error.
     * @param {String/Error} [error]
     */
    fireError: 		function( error ) {
    					
						error = typeof error === 'string' ? new Error(error) : error;

						console.log(&quot;\n========================================&quot;.red);
						util.error(error);
						console.log(&quot;========================================&quot;.red);
						
						var st = require('stack-trace'),
							trace = st.parse(error);
						while (trace.length &gt; 0 &amp;&amp; trace[0].fileName.indexOf('/node_modules/ngn') &gt;= 0)
							trace.shift();
						for (var i=0;i&lt;trace.length;i++){
							util.puts(('\nOn line #'+trace[i].lineNumber+', column #'+trace[i].columnNumber).underline.red+'\n'+trace[i].fileName.bold+(trace[i].functionName !== null ? '\nFunction: '.grey+trace[i].functionName.grey:''));
						}
						
						this.fireEvent('error',error);
						return true;
				    },
	
<span id='NGN-core-method-on'>	/**
</span>	 * @method
	 * Listens for an event name and runs the callback when it is recognized.
	 * @param {String} eventName
	 * @param {Function} callback
	 */
	on: 			function( eventName, callback ) {
						this._emitter.on(eventName, callback || __NGN.emptyFn);
					},
	
<span id='NGN-core-method-addEventListeners'>	/**
</span>	 * @method
	 * Adds multiple event listeners
 	 * @param {Array} evt
	 */
	addEventListeners: function(evt){
						for(var i=0;i&lt;evt.length;i++)
							this.on(evt[i].trim().toLowerCase(),this['on'+evt[i].trim()]);
					},
	
<span id='NGN-core-event-error'>	/**
</span>	 * @event error
	 * Fired when an error occurs
	 * @param {Object} e
	 */			
	onError:		function(e) {
						this.fireError(e);
					}
});

// Export the module for use in require() statements
module.exports = Class;</pre>
</body>
</html>
